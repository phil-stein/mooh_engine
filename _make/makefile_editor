# silent echo calls
# MAKEFLAGS += --silent
# instead silencing individual calls with '@'


# compiler plus flags, -g: debug info, -Wall: all warnings
#  -DEDITOR: compile with editor
#  -fcommon: ignore duplicate variable definitions
# CC         = @gcc -g -Wall -DEDITOR  -DASSETM_NO_ZIP -DDEBUG_TIMER -DDEBUG_DRAW -DPHYS_DEBUG -DINCLUDE_PLAY_MODE -DASSET_PATH=\"$(ASSET_PATH)\"
CC_NO_WARN 			= @gcc
CC         			= @gcc -g -Wall 
CC							+= $(CC_ARGS)
CC							+= -DASSET_PATH=\"$(ASSET_PATH)\"

BUILD_DIR = ..\_build

NAME = editor.exe
OUT  = $(BUILD_DIR)\$(NAME)

EXTERNAL_DIR = ../_external
SRC_DIR   	 = ../src
APPS_DIR  	 = ../apps
GLOBL_DIR 	 = $(SRC_DIR)/global
DATA_DIR  	 = $(SRC_DIR)/data
APP_DIR   	 = $(APPS_DIR)/editor
GUI_DIR   	 = $(APP_DIR)/gui

OBJ_DIR = $(BUILD_DIR)\bin_editor
LIB_DIR = ..\_libs\win64


# app
_OBJS = 				 				\
	app.o					 				\
	gui.o					 				\
	gui_struct_browser.o	\
	gizmo.o								\
	terrain_edit.o				\
	operation.o						\
	editor_save.o

# put the OBJ_DIR in front of the obj names
OBJS = $(patsubst %,$(OBJ_DIR)/%,$(_OBJS))
OBJS_WIN = $(patsubst %,$(OBJ_DIR)\\%,$(_OBJS))


_LIBS = 						\
	_mooh_core_editor	\
	_mooh_data				\
	glfw3							\
	gdi32							\
	user32						\
	kernel32					\
	opengl32					\
	freetype

LIBS     = $(patsubst %,-l %,$(_LIBS))

_INC = 							  				\
		$(EXTERNAL_DIR)	  				\
 		$(SRC_DIR)								\
 		$(APPS_DIR)								\
		$(DATA_DIR)
INC = $(patsubst %,-I %,$(_INC))

LIB_LINK = $(INC) -L $(LIB_DIR) $(LIBS) 


all: data core $(NAME)
	@echo asset path: $(ASSET_PATH)
	@echo $(CC)
	@echo ---- compiled $(NAME)


# compile mooh_core library
# $(MAKE) -C .. -f makefile_core	
core:
	@$(MAKE) -s -C .. core_editor	
data:
	@$(MAKE) -s -C .. data	


#	$(MAKE) -C ../.. when compiling from src/editor

# @cd ../.. && $(MAKE) && @cd src/editor

# compile all object files to .exe
$(NAME): $(OBJS) 
	$(CC) -o $(OUT) $(OBJS) $(LIB_LINK)


# compile all .c files to .o files
$(OBJ_DIR)/%.o: $(APP_DIR)/%.c
	@echo $< -> $@	
	$(CC) -c $< -o $@ $(INC)

$(OBJ_DIR)/%.o: $(GUI_DIR)/%.c
	@echo $< -> $@	
	$(CC) -c $< -o $@ $(INC)

# $(OBJ_DIR)/%.o: $(EXTERNAL_DIR)/ufbx/%.c
# 	echo $< -> $@	
# 	$(CC_NO_WARN) -c $< -o $@ $(INC)
# 
# $(OBJ_DIR)/%.o: $(EXTERNAL_DIR)/zip/%.c
# 	echo $< -> $@	
#  	$(CC_NO_WARN) -c $< -o $@ $(INC)


# prevents make from fideling with files named clean
.PHONY: clean

clean:
	@del $(OUT)
	@del $(OBJS_WIN) 
	@echo ---- clean $(NAME) 

# clean and them make all
cleanm: clean all

run: all
	@echo ---- started $(NAME)
	@$(OUT)

cleanrun: clean all
	@echo ---- started $(NAME) 
	@$(OUT)





