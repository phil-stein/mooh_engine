# silent echo calls
# MAKEFLAGS += --silent
# instead silencing individual calls with '@'


# compiler plus flags, -g: debug info, -Wall: all warnings
#  -DEDITOR: compile with editor
#  -fcommon: ignore duplicate variable definitions
# CC         = @gcc -g -Wall -DEDITOR  -DASSETM_NO_ZIP -DDEBUG_TIMER -DDEBUG_DRAW -DPHYS_DEBUG -DINCLUDE_PLAY_MODE -DASSET_PATH=\"$(ASSET_PATH)\"
CC         			= @gcc -g -Wall 
CC_NO_WARN 			= @gcc
CC							+= $(CC_ARGS)
CC							+= -DASSET_PATH=\"$(ASSET_PATH)\"

BUILD_DIR = ..\build

NAME = editor.exe
OUT  = $(BUILD_DIR)\$(NAME)

SRC_DIR   = ../src
GLOBL_DIR = $(SRC_DIR)/global
DATA_DIR  = $(SRC_DIR)/data
APP_DIR   = $(SRC_DIR)/editor

OBJ_DIR = $(BUILD_DIR)\bin_editor
LIB_DIR = ..\libs\win64

EXTERNAL_DIR = ../external
APP_INC			 = $(APP_DIR)

# app
_OBJS = 				 			\
	app.o					 			\
	gui.o					 			\
	gizmo.o							\
	terrain_edit.o

# put the OBJ_DIR in front of the obj names
OBJS = $(patsubst %,$(OBJ_DIR)/%,$(_OBJS))
OBJS_WIN = $(patsubst %,$(OBJ_DIR)\\%,$(_OBJS))


_LIBS = 						\
	_mooh_core_editor	\
	glfw3							\
	gdi32							\
	user32						\
	kernel32					\
	opengl32					

LIBS     = $(patsubst %,-l %,$(_LIBS))

_INC = 							  				\
		$(EXTERNAL_DIR)	  				\
 		$(SRC_DIR)								\
 		$(APP_INC)								
INC = $(patsubst %,-I %,$(_INC))

LIB_LINK = $(INC) -L $(LIB_DIR) $(LIBS) 


all: core $(NAME)
	@echo asset path: $(ASSET_PATH)
	@echo $(CC)
	@echo ---- compiled $(NAME)


# compile mooh_core library
# $(MAKE) -C .. -f makefile_core	
core:
	@$(MAKE) -s -C .. core_editor	


#	$(MAKE) -C ../.. when compiling from src/editor

# @cd ../.. && $(MAKE) && @cd src/editor

# compile all object files to .exe
$(NAME): $(OBJS) 
	$(CC) -o $(OUT) $(OBJS) $(LIB_LINK)


# compile all .c files to .o files
$(OBJ_DIR)/%.o: $(APP_DIR)/%.c
	@echo $< -> $@	
	$(CC) -c $< -o $@ $(INC)

# $(OBJ_DIR)/%.o: $(EXTERNAL_DIR)/ufbx/%.c
# 	echo $< -> $@	
# 	$(CC_NO_WARN) -c $< -o $@ $(INC)
# 
# $(OBJ_DIR)/%.o: $(EXTERNAL_DIR)/zip/%.c
# 	echo $< -> $@	
#  	$(CC_NO_WARN) -c $< -o $@ $(INC)


# prevents make from fideling with files named clean
.PHONY: clean

clean:
	@del $(OUT)
	@del $(OBJS_WIN) 
	@echo ---- clean $(NAME) 

# clean and them make all
cleanm: clean all

run: all
	@echo ---- started $(NAME)
	@$(OUT)

cleanrun: clean all
	@echo ---- started $(NAME) 
	@$(OUT)





